"use strict";(self.webpackChunkfl0_docs=self.webpackChunkfl0_docs||[]).push([[72],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),p=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(l.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(t),m=o,k=u["".concat(l,".").concat(m)]||u[m]||d[m]||i;return t?r.createElement(k,a(a({ref:n},c),{},{components:t})):r.createElement(k,a({ref:n},c))}));function k(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,a=new Array(i);a[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[u]="string"==typeof e?e:o,a[1]=s;for(var p=2;p<i;p++)a[p]=t[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2781:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=t(7462),o=(t(7294),t(3905));const i={},a="Node.js",s={unversionedId:"quickstarts/nodejs",id:"quickstarts/nodejs",title:"Node.js",description:"Listening to the Right Port",source:"@site/docs/quickstarts/nodejs.md",sourceDirName:"quickstarts",slug:"/quickstarts/nodejs",permalink:"/docs/quickstarts/nodejs",draft:!1,editUrl:"https://github.com/fl0zone/fl0-docs/tree/main/docs/quickstarts/nodejs.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Java",permalink:"/docs/quickstarts/java"},next:{title:"Python",permalink:"/docs/quickstarts/python"}},l={},p=[{value:"Listening to the Right Port",id:"listening-to-the-right-port",level:2},{value:"Express",id:"express",level:3},{value:"NestJS",id:"nestjs",level:3},{value:"Built-in Language Support",id:"built-in-language-support",level:2},{value:"Specifying a Node Version",id:"specifying-a-node-version",level:3},{value:"Building From a Subdirectory",id:"building-from-a-subdirectory",level:3},{value:"Running Scripts During Build Phase",id:"running-scripts-during-build-phase",level:3},{value:"Using NPM or Yarn",id:"using-npm-or-yarn",level:3},{value:"Without NPM or Yarn",id:"without-npm-or-yarn",level:3},{value:"Build and Serve a Frontend App",id:"build-and-serve-a-frontend-app",level:3},{value:"Dockerfile Support",id:"dockerfile-support",level:2},{value:"Javascript",id:"javascript",level:3},{value:"Typescript",id:"typescript",level:3}],c={toc:p},u="wrapper";function d(e){let{components:n,...t}=e;return(0,o.kt)(u,(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"nodejs"},"Node.js"),(0,o.kt)("h2",{id:"listening-to-the-right-port"},"Listening to the Right Port"),(0,o.kt)("p",null,"FL0 injects an environment variable called PORT into your application's container. Your app must listen on this port. Below are some examples of how to do this with popular frameworks."),(0,o.kt)("h3",{id:"express"},"Express"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="/app.js"',title:'"/app.js"'},'const express = require("express");\nconst app = express();\n\n// This line is important to ensure your app listens to the PORT env var\nconst port = process.env.PORT ?? 3000;\n\napp.listen(port, () => {\n  console.log(`App listening on port ${port}`);\n});\n')),(0,o.kt)("h3",{id:"nestjs"},"NestJS"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="/src/main.ts"',title:'"/src/main.ts"'},'import { NestFactory } from "@nestjs/core";\nimport { AppModule } from "./app.module";\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n\n  // This line is important to ensure your app listens to the PORT env var\n  await app.listen(process.env.PORT, "0.0.0.0");\n  console.log(`Application is running on: ${await app.getUrl()}`);\n}\nbootstrap();\n')),(0,o.kt)("h2",{id:"built-in-language-support"},"Built-in Language Support"),(0,o.kt)("p",null,"You can build and deploy a Node.js application without a Dockerfile using FL0's built-in automatic builds."),(0,o.kt)("h3",{id:"specifying-a-node-version"},"Specifying a Node Version"),(0,o.kt)("p",null,"FL0's build system checks the following files for a specified Node version, in this order:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"package.json")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},".nvmrc")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},".node-version"))),(0,o.kt)("h3",{id:"building-from-a-subdirectory"},"Building From a Subdirectory"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Support for subdirectories coming soon. Currently, your app must reside in the root directory of your repository.")),(0,o.kt)("h3",{id:"running-scripts-during-build-phase"},"Running Scripts During Build Phase"),(0,o.kt)("p",null,"FL0 will look for a ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json")," file and run the following scripts, if they exist:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"npm run build")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"npm start"))),(0,o.kt)("p",null,"If no scripts are specified, FL0 will run the file specified in the ",(0,o.kt)("inlineCode",{parentName:"p"},"main")," key in ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,o.kt)("p",null,"For example, the following ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json")," configuration will result in FL0 running ",(0,o.kt)("inlineCode",{parentName:"p"},"node ./src/index.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "fl0-docs",\n  "version": "1.0.0",\n  "main": "./src/index.js",\n  ...\n}\n')),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Support for additional scripts is coming soon.")),(0,o.kt)("p",null,"To run others build scripts, such as a ",(0,o.kt)("inlineCode",{parentName:"p"},"test")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"lint")," script, please append these to your ",(0,o.kt)("inlineCode",{parentName:"p"},"build")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"start")," script. For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "fl0-docs",\n  "version": "1.0.0",\n  "scripts": {\n    "lint": "eslint .",\n    "start": "npm run lint && node ./src/index.js"\n  }\n  ...\n}\n')),(0,o.kt)("h3",{id:"using-npm-or-yarn"},"Using NPM or Yarn"),(0,o.kt)("p",null,"FL0's build system automatically detects if your codebase requires a package manager. By default, NPM will be used unless a ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn.lock")," file is found. You can use the following files in the root of your repository to control NPM and Yarn configuration:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://docs.npmjs.com/cli/v8/using-npm/config#npmrc-files"},(0,o.kt)("inlineCode",{parentName:"a"},".npmrc"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://classic.yarnpkg.com/en/docs/yarnrc"},(0,o.kt)("inlineCode",{parentName:"a"},".yarnrc")))),(0,o.kt)("h3",{id:"without-npm-or-yarn"},"Without NPM or Yarn"),(0,o.kt)("p",null,"You can build a Node.js application that doesn't use NPM or ",(0,o.kt)("inlineCode",{parentName:"p"},"node_modules"),". FL0 will look for one of these files in the root of your repository and run it automatically:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"server.js"),(0,o.kt)("li",{parentName:"ol"},"app.js"),(0,o.kt)("li",{parentName:"ol"},"main.js"),(0,o.kt)("li",{parentName:"ol"},"index.js")),(0,o.kt)("h3",{id:"build-and-serve-a-frontend-app"},"Build and Serve a Frontend App"),(0,o.kt)("p",null,"Frameworks like React and Angular come with development servers that can be used to serve the built HTML content. This means you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"npm start")," to run these frontend frameworks. However, in some cases it is recommended to build source code into static HTML/CSS/JS and serve them directly. In this case, check our documentation on ",(0,o.kt)("a",{parentName:"p",href:"/docs/quickstarts/static-sites"},"serving static sites"),"."),(0,o.kt)("h2",{id:"dockerfile-support"},"Dockerfile Support"),(0,o.kt)("p",null,"Instead of relying on FL0's ",(0,o.kt)("a",{parentName:"p",href:"#built-in-language-support"},"built-in language support")," you can provide your own Dockerfile in the root of your repository. FL0 will create a container based on this Dockerfile and deploy it to your environment."),(0,o.kt)("p",null,"Below are some example multi-stage Dockerfiles designed to work well locally and on FL0. They are split into the following stages:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"development")," stage works on a local machine and watches for file changes, reloading as necessary"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"builder")," stage is used to build a production version of your app"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"production")," stage is what finally gets deployed to FL0. It is designed to only contain production dependencies and be as small as possible. Assets from the builder stage are copied into the production stage")),(0,o.kt)("h3",{id:"javascript"},"Javascript"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/Dockerfile"',title:'"/Dockerfile"'},'# Development stage\nFROM node:16 as development\nWORKDIR /usr/src/app\nCOPY package*.json tsconfig.json ./\nRUN npm install\nCOPY ./src ./src\nCMD [ "npm", "run", "start:dev" ]\n\n# Builder stage\nFROM development as builder\nWORKDIR /usr/src/app\nRUN rm -rf node_modules\nRUN npm ci --only=production\nRUN npm run build\n\n# Production stage\nFROM alpine:latest as production\nRUN apk --no-cache add nodejs ca-certificates\nWORKDIR /root/\nCOPY --from=builder /usr/src/app ./\nCMD [ "node", "./build/index.js" ]\n')),(0,o.kt)("h3",{id:"typescript"},"Typescript"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="/Dockerfile"',title:'"/Dockerfile"'},'# Development stage\nFROM node:16 as development\nWORKDIR /usr/src/app\nCOPY package*.json ./\nRUN npm install\nCOPY tsconfig.json tsconfig.build.json ./\nCOPY ./src ./src\nCMD [ "npm", "run", "start:dev" ]\n\n# Builder stage\nFROM development as builder\nWORKDIR /usr/src/app\nRUN rm -rf node_modules\nRUN npm ci --only=production\nRUN npm i -g @nestjs/cli @types/node\nRUN npm run build\n\n# Production stage\nFROM alpine:latest as production\nRUN apk --no-cache add nodejs ca-certificates\nWORKDIR /root/\nCOPY --from=builder /usr/src/app ./\nCMD [ "node", "dist/main" ]\n')))}d.isMDXComponent=!0}}]);